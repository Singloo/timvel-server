/*
 * File: /Users/origami/Desktop/timvel-server/test/test.js
 * Project: /Users/origami/Desktop/timvel-server
 * Created Date: Wednesday May 29th 2019
 * Author: Rick yang tongxue(🍔🍔) (origami@timvel.com)
 * -----
 * Last Modified: Wednesday May 29th 2019 10:10:20 am
 * Modified By: Rick yang tongxue(🍔🍔) (origami@timvel.com)
 * -----
 */
/*
 * File: /Users/origami/Desktop/timvel-server/aaaa.js
 * Project: /Users/origami/Desktop/timvel-server
 * Created Date: Wednesday May 29th 2019
 * Author: Rick yang tongxue(🍔🍔) (origami@timvel.com)
 * -----
 * Last Modified: Wednesday May 29th 2019 10:08:32 am
 * Modified By: Rick yang tongxue(🍔🍔) (origami@timvel.com)
 * -----
 */
import fs from 'fs';
import path from 'path';
import Axios from 'axios';
import { getFilename } from '../js/utils';
import OSS from 'ali-oss';
// /ai
const ALI_ENDPOINT = 'https://timvel-ai.oss-cn-hangzhou.aliyuncs.com/faces/';
const options = {
  accessKeyId: 'LTAIutK9KCZMTte9',
  accessKeySecret: 'ANM6JLzy2qeUGPu6WNPFW1ybVNNPtf',
  bucket: 'timvel-ai',
  region: 'oss-cn-hangzhou',
};
const client = new OSS({
  ...options,
  timeout: 30000,
});
const uploadImage = async localPath => {
  console.log('start uploading ', localPath);
  const start = Date.now();
  const filename = getFilename(localPath);
  await client.put('faces/' + filename, localPath);
  console.log('upload done ', (Date.now() - start) / 1000, localPath);
  return ALI_ENDPOINT + filename;
};
const writeImage = data => {
  const base64Data = data.replace(/^data:([A-Za-z-+/]+);base64,/, '');
  const imagePath = path.resolve('./images', Date.now() + '.png');
  fs.writeFileSync(imagePath, base64Data, 'base64');
  return imagePath;
};
const imageData = 'data:image/png;base64,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'
async function main(){
    const localPath = writeImage(imageData);
    const url = await uploadImage(localPath);
    console.log(url)

}

main()